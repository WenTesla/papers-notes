# 酿酒：在审计日志中提取有效威胁检测的基本见解Winemaking: Extracting Essential Insights for Efficient Threat Detection in Audit Logs

## APT的特点

- 来源图中恶意节点和良性节点之间的密集交互引入了*邻居噪声*，阻碍了有效检测
- 现有 APTs 检测模型的复杂预测机制导致数据中嵌入的先验知识利用不足
-  高计算成本使检测不切实

## 本文的工作

- 我们提出了 Winemaking，一种基于知识蒸馏的通用 APTs 检测方法，能够将 GNN 知识从大型教师模型转移到轻量级学生模型，从而减少检测过程中的资源和时间成本。
- 我们通过设计一种基于图拉普拉斯正则化的图信号去噪方法来解决出处图中的邻域噪声问题，该方法对为出处图量身定制的信号进行平滑和去噪。
- 我们研究了当前方法中复杂预测机制导致先验知识利用不足的问题，并设计了一个轻量级的学生模型来有效地学习和利用先验知识。
- 我们通过在三个广泛使用的数据集上实施 Winemaking 的性能并进行各种实验以验证其有效性。实验结果表明，Winemaking 优于大多数现有方法，同时检测成本较低。

## 工作对比

![模型对比](https://cdn.xljsci.com/literature/163655977/page3/hsee04.png)

只有Magic承认这个问题---降低噪声



## 框架

![img](https://oss.xljsci.com//literature/163655977/page0/1750819158676.png)

1. 图构造
2. 日志蒸馏
3. Threat检测
4. 攻击性重建

### 图构建

使用Word2Vec[31]，这是一种基于神经网络的技术，有效地学习单词向量表示，它为每个单词生成密集的低维向量。

> Word2Vec假设：文本中离得越近的词语相似度越高。语义相近的词在向量空间中距离更近
>
> onehot 输出的是多维向量，有多少词语就有多少维度

### 去噪（难理解）

酿酒过程采用了一种基于**图拉普拉斯正则化**的信号去噪方法，该方法旨在利用图的拓扑结构平滑信号并减少噪声的影响。

具体来说，酿酒过程根据实体节点之间的相似度和连接关系来定义权重，并将它们组合成权重矩阵

不会以任何方式改变图的拓扑结构，确保不会由于结构的变化而引入新的噪声。

### 知识蒸馏

==占位==

### 威胁检测

训练模式和检测模式

![img](https://cdn.xljsci.com/literature/163655977/page6/c5mgs2.png)





**检测模式**：我们将溯源图（带有初始特征）输入到学生模型中。经过轻量级 K 层 PRL 和特征转换步骤后，学生模型为每个节点𝑣预测一个异常分数。学生模型有效地在输入图中传递消息并聚合信息，基于学习到的轻量级特征表示对节点进行分类。然后将每个节点输出的异常分数与预设阈值进行比较，超过该阈值的节点被标记为潜在恶意节点，并收集到恶意节点集中

> PRL - 将标签从标记节点传播到未标记节点。

### 攻击重构

酿酒重建了一个更详细的攻击轨迹，捕捉完整的攻击链，而不依赖于先验知识。

具体来说，Winemaking 利用 Infomap [12]，这是一种基于随机游走的算法，用于模拟信息如何在节点之间传播，并将图划分为紧密连接的社区。恶意节点及其一跳邻居被赋予更高的权重，以将它们与良性节点连接区分开来。接下来，进行信息流传播，信息根据加权概率在图中传播，合并节点以形成社区。

## 评估

### 数据集

- SteamSpot数据集
- Unicorn Wget数据集
- DARPA-E3数据集

### 基准

- StreamSpot[22]: StreamSpot通过分析信息流图来检测入侵。它从图中提取特征来学习良性模型，并使用聚类方法来检测异常图。
- Unicorn b[15]: Unicorn利用图形呈现技术有效地总结长时间运行的系统执行。它将图形分类为良性或恶意，并过滤异常情况。
- provi - gem [24]: provi - gem在监督信号的帮助下，使用统一的关系感知嵌入框架捕获实体交互。
- ThreaTrace[45]: ThreaTrace定制了一种新的GraphSAGE方法来聚合系统实体节点，从而实现节点级检测。
- Log2vec b[29]: Log2vec是一种基于异构图嵌入的方法，用于检测企业内部的网络威胁。它使用节点嵌入和聚类方法识别异常日志。
- MAGIC[23]: MAGIC是一种多粒度检测方法，通过图形掩蔽技术实现高效检测和降低成本。

### 效果

![img](https://cdn.xljsci.com/literature/163655977/page7/vyp552.png)

蒸馏之后ACC提高

![img](https://cdn.xljsci.com/literature/163655977/page8/k3copi.png)

其他方法对比，最好或者次好

### 消融实验

![img](https://cdn.xljsci.com/literature/163655977/page7/1x47ce.png)

**特征变换显著降低了性能**——精确率（PR）下降了14%，召回率（RC）下降了8%，准确率（ACC）下降了16%。这表明基于特征的先验知识对于节点推理任务中的深度学习至关重要。没有它，学生模型就失去了从系统实体属性中进行深度学习的能力。

我们从学生模型中移除了标签传播机制（PRL），仅保留特征变换机制。如图4（b）所示，**缺少PRL导致性能下降更为显著**——精确率（PR）下降24%，召回率（RC）下降19%，准确率（ACC）下降33%。这突出表明，PRL所提供的基于结构和标签的先验知识至关重要，它使学生模型能够有效地利用上下文信息和时间信息。 

### 超参数

![img](https://cdn.xljsci.com/literature/163655977/page7/8os90a.png)

32维度最好

当批次中包含 100 个标记节点时达到接近最优的性能。

### 对抗攻击的鲁棒形

通过模仿良性进程的行为来逃避检测

首先，我们从正常训练数据中选择良性系统实体。接下来，我们引入事件并将其与良性实体相结合。最后，我们嵌入攻击图中的良性节点

与Flash比较，flash效果不好

![img](https://cdn.xljsci.com/literature/163655977/page8/ovw87f.png)

## 个人总结

### 创新点

- 知识蒸馏
- 溯源图
- 基于图拉普拉斯的方法来对产地图进行邻域去噪和信号平滑
- GNN

### 评价

不开源

技术部分难理解



## 附录

StreamSpot

![StreamSpot](https://cdn.xljsci.com/literature/163655977/page11/ahp475.png)

Unicorn Wget

![Unicorn Wget](https://cdn.xljsci.com/literature/163655977/page11/wwvjtb.png)

![Darpa-E3](https://cdn.xljsci.com/literature/163655977/page11/gvtxj8.png)

