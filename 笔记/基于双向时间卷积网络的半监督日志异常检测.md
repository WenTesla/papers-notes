# 基于双向时间卷积网络的半监督日志异常检测

## 摘要

首先，通过改进字典的日志解析方法，保留了日志事件中的部分参数信息，从而提高日志信息的利用率和日志解析的准确率；

然后，使用BERT对模板中的语义信息进行编码，获得日志的语义向量；
接着采用聚类的方法进行标签估计，缓解了数据标注不足的问题，有效提高了模型对不稳定数据的检测；

最后，使用带有残差块的双向时间卷积网络（BI-TCN）从两个方向捕获上下文信息，提高了异常检测的精度和效率



## 整体框架

<img src="https://oss.xljsci.com//literature/176302210/page0/1757569155568.png" alt="img"  />

## 日志解析

首先，对每个日志事件进行分隔并形成一组单词标记。 由于日志事件中包含许多特殊符号，所以采用空格及日志中常用的特殊分隔符来分割日志事件字符串。 根据引入的字典，将所有的单词标记进行字典化，有效单词放入单词集中。 然后，将日志事件根据单词集进行集群，具有相同单词集并且每个单词词频相同的日志事件被归为同一集群，每个集群使用最长公共序列提取维护一个模板。 接下来，将所有不同集群获得的粗略模板按照顺序生成前缀树，用来整合最终的模板。



## 语义向量化

BERT词嵌入模型的核心是TRANSFORMER编码器，使用双向自注意力机制能够学习到单词上下文的相关性，能够根据周围的单词动态地产生单词表示形式。

## 日志分组

滚动窗口是基于日志时间戳数据取相同窗口大小的日志，互不重叠。 滑动窗口也是基于日志时间戳数据，依据窗口大小和步长划分，其前后窗口会重叠。 会话窗口是基于日志的会话标识符进行分组。

本文采取**基于日志时间戳**结合日志条目中**某个特定数据项**将日志重排并固定窗口大小 ｗ 进行日志分组

## 聚类

先使用FAST-ICA降维，然后使用ＨＤＢＳＣＡＮ聚类。

这样，将训练集中的日志序列分成若干簇，语义相似的日志序列划分到同一簇中，同簇的日志序列共享相同的标签。 通过测量未标记日志序列属于每个标签的概率来为每个未标记日志序列指定概率标签，以减少噪声的影响。
$$
P(normal)=1-\frac{score}2\\ P(anomalous)=\frac{score}2
$$

```
# 示例：获取样本的隶属度分数
membership_scores = clusterer.probabilities_  # 长度等于样本数，每个值对应一个样本的隶属度
print("前10个样本的隶属度分数：", membership_scores[:10])
# 输出示例：[0.98, 0.99, 0.87, 0.95, 0.62, 0.31, -1, -1, 0.92, 0.88]
# 注：噪声点（标签-1）的隶属度分数为-1或NaN
```



## 异常检测

日志序列Ｓ＝｛ｅ~１~ ，ｅ~２~ ，…，ｅ~ｎ~ ｝得到日志序列语义向量表示为 Ｖ ＝ ｛ｖ~１~ ，ｖ~２~ ，…，ｖ~ｎ~｝，其中 ｎ 为该日志序列长度，ｅ~ｔ~（１≤ｔ≤ｎ）是第ｔ个日志事件，将其中每个日志事件 ｅ~ｔ~ 都对应地表示为语义向量 ｖ~t~ ，从而将其放入到 Bi-TCN中。



![img](https://oss.xljsci.com//literature/176302210/page0/1757571445119.png)

## 结果

![日志解析](https://oss.xljsci.com//literature/176302210/page0/1757572100337.png)

![img](https://oss.xljsci.com//literature/176302210/page0/1757572794124.png)

![img](https://oss.xljsci.com//literature/176302210/page0/1757572851291.png)