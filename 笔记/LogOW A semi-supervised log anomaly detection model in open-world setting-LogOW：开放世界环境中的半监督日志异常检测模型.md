# LogOW: A semi-supervised log anomaly detection model in open-world setting-LogOW：开放世界环境中的半监督日志异常检测模型

## 摘要

**开放世界问题意味着测试集可能包含训练集中没有的新类**，**而冷启动问题意味着初始训练数据稀缺，无论是正常日志序列还是异常日志序列。大多数现有方法都假设封闭世界设置并依赖于足够的正常数据，这限制了它们对新日志环境的适应性。**

**我们提出了 LogOW，一种新颖的日志异常检测模型，可以从一些正常的日志序列中学习。该模型通过开放世界样本检索模块在开放世界环境中发现新兴的正常日志序列。通过增量预训练模块，这些日志序列以在线模式对模型参数进行微调。**

**首先，我们使用掩码语言建模（MLM）从正常日志序列训练基本模型。在测试阶段，我们将通过新颖的动态多重掩模获得的异常分数和不确定性分数结合起来，以区分测试集中的封闭世界正常日志序列。接下来，我们基于融合序列和计数特征对开放世界日志序列进行聚类，并识别异常日志序列和新的正常日志序列。最后，我们在下一个时间段用新的正常序列更新我们的模型。对三个日志数据集和现实世界机场日志的实验表明，我们的模型在开放世界和缺乏训练数据设置的情况下优于传统模型**

## 介绍

当遇到新的日志类时，这些模型可能会产生两种错误：**一是将正常的新日志类误判为异常**，从而引起误报，另一种是将**异常的新增日志类误判为正常，导致漏报。**

![日志格式](https://cdn.xljsci.com/literature/128270751/page2/0sft4w.png)

现有的工作基于正常数据足够并且所有其他日志（与它们不相似）都是异常的假设来解决开放世界问题。因此，它们**完全依赖于与现有正常日志的相似性**。然而，这种假设并不总是正确的。在缺乏足够的训练数据或标记数据的情况下，有效地执行日志异常检测非常重要。



此外，为了处理开放世界中的动态问题，我们提出了一种基于多个随机掩码操作的异常检测方法，该方法利用不同掩码序列的差异来反映模型对输入序列的不确定性并划分测试数据集分为正常数据集和混合数据集（包含异常数据和开放世界正常数据）。

在预测阶段，我们使用**特征融合和聚类方法**来进一步**区分混合数据集中的异常数据和开放世界正常数据**。最后，我们将检索到的开放世界正常数据输入到模型中进行持续训练，使模型具有适应能力，从而提高模型预测的准确性和鲁棒性。

![结构](https://cdn.xljsci.com/literature/128270751/page4/cgngk5.png)

### 不确定性

**动态多掩模方法**，这是一种新的测试时间增强（TTA）方法。动态多掩模使用模型本身的结构和参数来估计不确定性。它在测试时多次随机屏蔽输入数据，并使用增强数据进行预测。然后，它根据这些预测结果之间的差异来估计模型的不确定性

## 训练



### 欲训练

增量学习（IL）思想（Gururangan et al., 2020），使模型能够从输入的新数据中学习新知识，同时保留以前的知识。

### 预测阶段





### 模型输出的不确定性估计

**首先，阈值需要手动设置，这可能导致阈值设置的不合理性。其次，无法评估模型输出结果的可靠性**。特别是在开放世界设置中，新样本可能导致模型输出结果不准确。开放世界机器学习的主要挑战之一是测试集中可能出现训练期间看不到的新样本，导致模型识别不准确。为了解决这个问题，我们建议引入不确定性估计方法。不确定性估计为模型的每个输出结果提供置信度，反映结果的可信度。

![img](https://cdn.xljsci.com/literature/128270751/page6/oz0j3f.png)

我们将训练阶段的传统传销方法替换为**动态多重掩码**，这意味着每个日志事件序列被多次掩码。为了将不同长度的日志序列输入到模型中，我们采用了与BERT相似的方法，即在日志序列的开头添加CLS标记来表示整个日志序列的分类信息。



![img](https://cdn.xljsci.com/literature/128270751/page6/fobtua.png)

### 基于特征融合的开放世界样本检索

将测试集分为高置信度正常数据集和低置信度混合数据集。

为了进一步区分新的异常日志序列和正日志对数序列，我们对低置信度混合数据集进行了进一步的分析
